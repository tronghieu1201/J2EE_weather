<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biểu đồ Thời tiết - Weather</title>
    <!-- Preconnect for faster loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link th:href="@{/css/tailwind.min.css(v=${cacheBuster})}" rel="stylesheet">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <!-- Tailwind CSS Production Build -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <link rel="stylesheet" th:href="@{/css/chart.css}">
    <style>
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #475569;
        }

        .dark ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
        }

        .dark .glass {
            background: rgba(30, 41, 59, 0.7);
        }

        #page-wrapper {
            transform: scale(0.75);
            transform-origin: top left;
            width: calc(100% / 0.75);
            min-height: calc(100vh / 0.75);
            overflow-x: hidden;
            position: absolute;
            top: 0;
            left: 0;
        }

        body {
            min-height: calc(100vh / 0.75);
            overflow-y: auto;
        }
    </style>
</head>
<script th:src="@{/js/darkmode.js(v=${cacheBuster})}"></script>

<body
    class="bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark font-sans transition-colors duration-300 min-h-screen flex flex-col">
    <div id="page-wrapper" class="bg-background-light dark:bg-background-dark">

        <!-- Navbar -->
        <nav
            class="sticky top-0 z-50 bg-surface-light/90 dark:bg-surface-dark/90 backdrop-blur-md shadow-sm border-b border-gray-200 dark:border-gray-700">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex-shrink-0 flex items-center gap-2">
                        <a th:href="@{/index}" class="flex items-center gap-2">
                            <img th:src="@{/img/z.png}" alt="Weather Icon" class="w-[75px] h-[60px]">
                            <span
                                class="font-bold text-xl tracking-tight bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">Weather</span>
                        </a>
                    </div>
                    <div
                        class="hidden md:flex items-center space-x-6 text-base font-semibold ml-8 pl-8 border-l border-gray-200 dark:border-gray-700">
                        <a class="text-slate-500 hover:text-primary-dark dark:text-slate-400 dark:hover:text-slate-200 transition-colors whitespace-nowrap"
                            th:href="@{/index}">Trang chủ</a>
                        <div class="relative group">
                            <a class="text-slate-500 hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200 transition-colors cursor-pointer whitespace-nowrap"
                                id="navbarDropdownMenuLink">
                                Tỉnh/Thành phố
                            </a>
                            <div
                                class="absolute hidden group-hover:block bg-surface-light dark:bg-surface-dark shadow-lg rounded-md mt-2 p-4 min-w-max z-50">
                                <div
                                    class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-x-6 gap-y-2 max-h-96 overflow-y-auto">
                                    <th:block th:each="entry : ${groupedCities}">
                                        <div>
                                            <p class="text-xs font-semibold text-slate-500 dark:text-slate-400 mb-2"
                                                th:text="${entry.key}"></p>
                                            <div class="space-y-1">
                                                <a th:each="province : ${entry.value}" href="javascript:void(0)"
                                                    th:onclick="loadChartData('[(${province})]');"
                                                    class="block px-3 py-1 text-sm text-slate-700 dark:text-slate-300 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-md transition-colors whitespace-nowrap"
                                                    th:text="${province}"></a>
                                            </div>
                                        </div>
                                    </th:block>
                                </div>
                            </div>
                        </div>

                        <a class="text-primary font-semibold dark:text-blue-400 transition-colors whitespace-nowrap"
                            th:href="@{/chart}">Biểu đồ</a>
                        <a class="text-slate-500 hover:text-primary-dark dark:text-slate-400 dark:hover:text-slate-200 transition-colors whitespace-nowrap"
                            th:href="@{/perpetual-calendar}">Xem lịch vạn niên</a>
                        <a class="text-slate-500 hover:text-primary-dark dark:text-slate-400 dark:hover:text-slate-200 transition-colors whitespace-nowrap"
                            th:href="@{/weather-news}">Tin tức</a>
                    </div>
                    <div class="hidden md:flex items-center gap-4">
                        <div class="relative">
                            <form id="searchForm" onsubmit="handleSearch(event)" class="flex items-center ml-4">
                                <input id="cityInput"
                                    class="pl-10 pr-4 py-2 rounded-full border border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-slate-700 text-sm focus:ring-2 focus:ring-primary focus:border-transparent outline-none w-64 transition-all"
                                    placeholder="Tìm kiếm..." type="text" name="city" />
                                <span
                                    class="material-icons-round absolute left-7 top-1/2 -translate-y-1/2 text-gray-400 text-lg">search</span>
                                <button
                                    class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-full text-sm font-medium shadow-lg shadow-blue-500/30 transition-all transform hover:scale-105"
                                    type="submit">
                                    Tìm kiếm
                                </button>
                            </form>
                        </div>
                        <div
                            class="flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400 ml-2 border-l pl-4 border-gray-200 dark:border-gray-700">
                            <span class="material-icons-round text-base">schedule</span>
                            <span id="local-time" style="font-variant-numeric: tabular-nums;">00:00:00</span>
                        </div>
                        <button class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors"
                            onclick="toggleTheme()">
                            <span id="themeIcon"
                                class="material-icons-round text-slate-500 dark:text-yellow-400">dark_mode</span>
                        </button>
                    </div>
                    <div class="md:hidden flex items-center">
                        <button
                            class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-white focus:outline-none">
                            <span class="material-icons-round">menu</span>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main id="chartArea" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
            <div class="chart-container space-y-6">
                <div id="loadingArea"
                    class="bg-surface-light dark:bg-surface-dark rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-6 flex flex-col items-center justify-center h-96">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
                    <p class="mt-4 text-slate-500 dark:text-slate-400">Đang tải dữ liệu biểu đồ...</p>
                </div>

                <div id="errorArea" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md"
                    role="alert">
                    <div class="flex">
                        <div class="py-1"><span class="material-icons-round text-red-500 mr-2">error</span></div>
                        <div>
                            <p class="font-bold">Lỗi</p>
                            <p>Không thể tải dữ liệu biểu đồ. Vui lòng thử lại.</p>
                        </div>
                    </div>
                </div>

                <div id="chartContent" class="hidden">
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- Nhiệt độ TB -->
                        <div
                            class="relative group bg-surface-light dark:bg-surface-dark rounded-2xl p-6 shadow-soft hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 dark:border-gray-700">
                            <div
                                class="absolute top-0 right-0 w-24 h-24 bg-indigo-500/10 rounded-bl-full -mr-6 -mt-6 transition-transform group-hover:scale-110">
                            </div>
                            <div class="relative z-10 flex items-center gap-4">
                                <div
                                    class="p-3 rounded-xl bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                                    <span class="material-icons-round text-2xl">thermostat</span>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-slate-800 dark:text-white group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors"
                                        id="avgTemp">--°C</div>
                                    <div class="text-sm text-slate-500 dark:text-slate-400">Nhiệt độ TB</div>
                                </div>
                            </div>
                        </div>
                        <!-- Nhiệt độ cao nhất -->
                        <div
                            class="relative group bg-surface-light dark:bg-surface-dark rounded-2xl p-6 shadow-soft hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 dark:border-gray-700">
                            <div
                                class="absolute top-0 right-0 w-24 h-24 bg-pink-500/10 rounded-bl-full -mr-6 -mt-6 transition-transform group-hover:scale-110">
                            </div>
                            <div class="relative z-10 flex items-center gap-4">
                                <div
                                    class="p-3 rounded-xl bg-pink-50 dark:bg-pink-900/30 text-pink-600 dark:text-pink-400 group-hover:bg-pink-600 group-hover:text-white transition-colors">
                                    <span class="material-icons-round text-2xl">wb_sunny</span>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-slate-800 dark:text-white group-hover:text-pink-600 dark:group-hover:text-pink-400 transition-colors"
                                        id="maxTemp">--°C</div>
                                    <div class="text-sm text-slate-500 dark:text-slate-400">Nhiệt độ cao nhất</div>
                                </div>
                            </div>
                        </div>
                        <!-- Nhiệt độ thấp nhất -->
                        <div
                            class="relative group bg-surface-light dark:bg-surface-dark rounded-2xl p-6 shadow-soft hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 dark:border-gray-700">
                            <div
                                class="absolute top-0 right-0 w-24 h-24 bg-amber-500/10 rounded-bl-full -mr-6 -mt-6 transition-transform group-hover:scale-110">
                            </div>
                            <div class="relative z-10 flex items-center gap-4">
                                <div
                                    class="p-3 rounded-xl bg-amber-50 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 group-hover:bg-amber-600 group-hover:text-white transition-colors">
                                    <span class="material-icons-round text-2xl">ac_unit</span>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-slate-800 dark:text-white group-hover:text-amber-600 dark:group-hover:text-amber-400 transition-colors"
                                        id="minTemp">--°C</div>
                                    <div class="text-sm text-slate-500 dark:text-slate-400">Nhiệt độ thấp nhất</div>
                                </div>
                            </div>
                        </div>
                        <!-- Xác suất mưa TB -->
                        <div
                            class="relative group bg-surface-light dark:bg-surface-dark rounded-2xl p-6 shadow-soft hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 dark:border-gray-700">
                            <div
                                class="absolute top-0 right-0 w-24 h-24 bg-emerald-500/10 rounded-bl-full -mr-6 -mt-6 transition-transform group-hover:scale-110">
                            </div>
                            <div class="relative z-10 flex items-center gap-4">
                                <div
                                    class="p-3 rounded-xl bg-emerald-50 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 group-hover:bg-emerald-600 group-hover:text-white transition-colors">
                                    <span class="material-icons-round text-2xl">water_drop</span>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-slate-800 dark:text-white group-hover:text-emerald-600 dark:group-hover:text-emerald-400 transition-colors"
                                        id="avgRain">--%</div>
                                    <div class="text-sm text-slate-500 dark:text-slate-400">Xác suất mưa TB</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Temperature Chart -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-6 mt-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="font-bold text-slate-800 dark:text-white flex items-center gap-2">
                                <span class="material-icons-round text-slate-500">show_chart</span>
                                Biểu đồ Nhiệt độ 7 ngày
                            </h2>
                            <span
                                class="bg-primary/10 text-primary text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full dark:bg-primary/20 dark:text-indigo-300"
                                id="currentCity">Hồ Chí Minh</span>
                        </div>
                        <div class="h-80">
                            <canvas id="temperatureChart"></canvas>
                        </div>
                    </div>

                    <!-- Rain Probability Chart -->
                    <div
                        class="bg-surface-light dark:bg-surface-dark rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-6 mt-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="font-bold text-slate-800 dark:text-white flex items-center gap-2">
                                <span class="material-icons-round text-slate-500">umbrella</span>
                                Xác suất mưa 7 ngày
                            </h2>
                        </div>
                        <div class="h-80">
                            <canvas id="rainChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="bg-surface-light dark:bg-surface-dark border-t border-gray-200 dark:border-gray-700 mt-8 py-12">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 lg:gap-12">
                    <!-- Cột 1: Giới thiệu dự án -->
                    <div>
                        <div class="flex items-center gap-2 mb-4">
                            <img th:src="@{/img/z.png}" alt="Weather Logo" class="w-[60px] h-[48px]">
                            <span
                                class="font-bold text-xl tracking-tight bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">Weather</span>
                        </div>
                        <p class="text-sm text-slate-500 dark:text-slate-400 leading-relaxed mb-4">
                            Thực tại không phải là một vật thể có sẵn nằm ngoài kia để ta quan sát, mà là một cấu trúc ý
                            hướng được dệt nên từ sự tương tác không thể tách rời giữa ý thức chủ thể và thế giới; do
                            đó, khi ta nhìn vào một bông hoa, ta không nhìn thấy chính bông hoa đó như nó là (cái vật tự
                            thân), mà chỉ đang nhìn thấy sự phản chiếu của chính cấu trúc nhận thức và những trải nghiệm
                            tiền-phản tính của chúng ta đang 'gán nghĩa' lên nó trong một khoảnh khắc hiện tại vĩnh cửu.
                        </p>
                        <div class="flex gap-3">
                            <a href="#"
                                class="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg hover:bg-primary hover:text-white transition-colors">
                                <span class="material-icons-round text-lg">facebook</span>
                            </a>
                            <a href="#"
                                class="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg hover:bg-primary hover:text-white transition-colors">
                                <span class="material-icons-round text-lg">share</span>
                            </a>
                        </div>
                    </div>

                    <!-- Cột 2: Điều hướng nhanh -->
                    <div>
                        <h4
                            class="font-bold text-slate-800 dark:text-white mb-4 uppercase text-sm tracking-wider flex items-center gap-2">
                            <span class="material-icons-round text-primary text-base">navigation</span>
                            Điều Hướng
                        </h4>
                        <ul class="space-y-3 text-sm">
                            <li>
                                <a th:href="@{/}"
                                    class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2">
                                    <span class="material-icons-round text-xs">chevron_right</span>
                                    Trang chủ
                                </a>
                            </li>
                            <li>
                                <a th:href="@{/chart}"
                                    class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2">
                                    <span class="material-icons-round text-xs">chevron_right</span>
                                    Biểu đồ thời tiết
                                </a>
                            </li>
                            <li>
                                <a th:href="@{/perpetual-calendar}"
                                    class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2">
                                    <span class="material-icons-round text-xs">chevron_right</span>
                                    Lịch vạn niên
                                </a>
                            </li>
                            <li>
                                <a th:href="@{/weather-news}"
                                    class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2">
                                    <span class="material-icons-round text-xs">chevron_right</span>
                                    Tin tức thời tiết
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- Cột 3: Chính sách -->
                    <div>
                        <h4
                            class="font-bold text-slate-800 dark:text-white mb-4 uppercase text-sm tracking-wider flex items-center gap-2">
                            <span class="material-icons-round text-primary text-base">verified_user</span>
                            Chính Sách
                        </h4>
                        <ul class="space-y-3 text-sm">
                            <li>
                                <a href="#"
                                    class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2">
                                    <span class="material-icons-round text-xs">chevron_right</span>
                                    Điều khoản sử dụng
                                </a>
                            </li>
                            <li>
                                <a href="#"
                                    class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2">
                                    <span class="material-icons-round text-xs">chevron_right</span>
                                    Chính sách bảo mật
                                </a>
                            </li>
                            <li>
                                <a href="#"
                                    class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2">
                                    <span class="material-icons-round text-xs">chevron_right</span>
                                    Quyền riêng tư
                                </a>
                            </li>
                            <li>
                                <a href="#"
                                    class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2">
                                    <span class="material-icons-round text-xs">chevron_right</span>
                                    Nguồn dữ liệu
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- Cột 4: Liên hệ -->
                    <div>
                        <h4
                            class="font-bold text-slate-800 dark:text-white mb-4 uppercase text-sm tracking-wider flex items-center gap-2">
                            <span class="material-icons-round text-primary text-base">contact_mail</span>
                            Liên Hệ
                        </h4>
                        <div class="space-y-3 text-sm text-slate-500 dark:text-slate-400">
                            <div class="flex items-start gap-3">
                                <span class="material-icons-round text-primary text-base mt-0.5">location_on</span>
                                <span>TP. Hồ Chí Minh, Việt Nam</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="material-icons-round text-primary text-base">email</span>
                                <a href="mailto:lgbbq9999@gmail.com"
                                    class="hover:text-primary transition-colors">lgbbq9999@gmail.com</a>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="material-icons-round text-primary text-base">phone</span>
                                <a href="tel:0342157199" class="hover:text-primary transition-colors">0342 157 199</a>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="material-icons-round text-primary text-base">schedule</span>
                                <span>Hỗ trợ 24/7</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Copyright -->
                <div
                    class="border-t border-gray-100 dark:border-gray-800 mt-10 pt-6 flex flex-col md:flex-row justify-between items-center gap-4">
                    <p class="text-sm text-slate-400">
                        © 2025 <span class="font-semibold text-primary">Weather Forecast</span> Đồ án J2EE - Dự báo
                        thời tiết.
                    </p>
                    <p class="text-xs text-slate-400">
                        Những Thằng Lính
                    </p>
                </div>
            </div>
        </footer>

    </div>

    <script th:src="@{/js/chart.js(v=${cacheBuster})}" defer></script>
    <script th:src="@{/js/footer.js(v=${cacheBuster})}" defer></script>

</body>

</html>