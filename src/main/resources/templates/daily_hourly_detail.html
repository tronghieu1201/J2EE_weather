<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="'Chi tiết giờ theo ngày - ' + ${city} + ' - ' + ${date}">Chi tiết giờ theo ngày</title>
    <!-- Preconnect for faster loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link th:href="@{/css/tailwind.min.css(v=${cacheBuster})}" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <!-- Tailwind CSS Production Build -->
    <style>
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #475569;
        }

        #page-wrapper {
            transform: scale(0.75);
            transform-origin: top left;
            width: calc(100% / 0.75);
            min-height: calc(100vh / 0.75);
            overflow-x: hidden;
            position: absolute;
            top: 0;
            left: 0;
        }

        body {
            min-height: calc(100vh / 0.75);
            overflow-y: auto;
        }
    </style>
</head>
<script th:src="@{/js/darkmode.js(v=${cacheBuster})}"></script>

<body
    class="bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark font-sans transition-colors duration-300 min-h-screen flex flex-col">
    <div id="page-wrapper">
        <!-- Navbar -->
        <nav
            class="sticky top-0 z-50 bg-surface-light/90 dark:bg-surface-dark/90 backdrop-blur-md shadow-sm border-b border-gray-200 dark:border-gray-700">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex-shrink-0 flex items-center gap-2">
                        <a th:href="@{/index}" class="flex items-center gap-2">
                            <img th:src="@{/img/z.png}" alt="Weather Icon" class="w-[75px] h-[60px]">
                            <span
                                class="font-bold text-xl tracking-tight bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">Weather</span>
                        </a>
                    </div>
                    <div class="hidden md:flex items-center space-x-6 text-base font-semibold">
                        <a class="text-slate-500 hover:text-primary-dark dark:text-slate-400 dark:hover:text-slate-200 transition-colors whitespace-nowrap"
                            th:href="@{/index}">Trang chủ</a>
                        <a class="text-slate-500 hover:text-primary-dark dark:text-slate-400 dark:hover:text-slate-200 transition-colors whitespace-nowrap"
                            th:href="@{/chart}">Biểu đồ</a>
                        <a class="text-slate-500 hover:text-primary-dark dark:text-slate-400 dark:hover:text-slate-200 transition-colors whitespace-nowrap"
                            th:href="@{/perpetual-calendar}">Xem lịch vạn niên</a>
                        <a class="text-slate-500 hover:text-primary-dark dark:text-slate-400 dark:hover:text-slate-200 transition-colors whitespace-nowrap"
                            th:href="@{/weather-news}">Tin tức</a>
                    </div>
                    <div class="hidden md:flex items-center gap-4">
                        <div
                            class="flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400 ml-2 border-l pl-4 border-gray-200 dark:border-gray-700">
                            <span class="material-icons-round text-base">schedule</span>
                            <span id="local-time" style="font-variant-numeric: tabular-nums;">00:00:00</span>
                        </div>
                        <button class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors"
                            onclick="toggleTheme()">
                            <span id="themeIcon"
                                class="material-icons-round text-slate-500 dark:text-yellow-400">dark_mode</span>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
            <!-- Back Button -->
            <a th:href="@{/}"
                class="inline-flex items-center gap-2 bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-300 px-4 py-2 rounded-full text-sm font-medium transition-all mb-6">
                <span class="material-icons-round text-lg">arrow_back</span>
                Trở về trang chính
            </a>

            <!-- Title -->
            <div
                class="bg-surface-light dark:bg-surface-dark rounded-2xl shadow-soft border border-primary/20 dark:border-primary/30 p-6 mb-6 relative overflow-hidden transition-all duration-300 hover:shadow-glow hover:border-primary/50">
                <div
                    class="absolute top-0 right-0 w-16 h-16 bg-gradient-to-br from-primary/10 to-transparent rounded-bl-full">
                </div>
                <div class="flex items-center gap-3 mb-2">
                    <span class="material-icons-round text-primary text-3xl">schedule</span>
                    <h1 class="text-2xl font-bold text-slate-800 dark:text-white"
                        th:text="'Dự báo theo giờ cho ' + ${city}"></h1>
                </div>
                <p class="text-slate-500 dark:text-slate-400 text-sm"
                    th:text="'Ngày ' + ${#temporals.format(date, 'dd/MM/yyyy')}"></p>
            </div>

            <!-- Warning if no data -->
            <div th:if="${hourlyForecast == null or #lists.isEmpty(hourlyForecast)}"
                class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6 rounded-md" role="alert">
                <p>Không thể tải dữ liệu dự báo theo giờ cho ngày này.</p>
            </div>

            <!-- Hourly Forecast Cards -->
            <div th:if="${hourlyForecast != null and not #lists.isEmpty(hourlyForecast)}"
                class="bg-surface-light dark:bg-surface-dark rounded-2xl shadow-soft border border-primary/20 dark:border-primary/30 p-6 relative overflow-hidden transition-all duration-300 hover:shadow-glow hover:border-primary/50">
                <div
                    class="absolute top-0 right-0 w-16 h-16 bg-gradient-to-br from-primary/10 to-transparent rounded-bl-full">
                </div>
                <div class="flex items-center gap-2 mb-6">
                    <span class="material-icons-round text-primary">wb_sunny</span>
                    <h3 class="font-bold text-slate-800 dark:text-white">Dự báo theo từng giờ</h3>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4"
                    id="hourlyGrid" th:attr="data-forecast-date=${#temporals.format(date, 'yyyy-MM-dd')}">
                    <div th:each="hour, iterStat : ${hourlyForecast}"
                        class="hourly-card relative group bg-surface-light dark:bg-surface-dark rounded-2xl p-4 shadow-soft hover:shadow-xl transition-all duration-300 overflow-hidden flex flex-col items-center hover:scale-[1.02] cursor-pointer"
                        th:attr="data-hour=${#temporals.format(hour.time, 'HH')}">

                        <!-- Decorative corner - màu thay đổi theo index -->
                        <div th:classappend="${iterStat.index % 4 == 0} ? 'bg-indigo-500/10' : (${iterStat.index % 4 == 1} ? 'bg-pink-500/10' : (${iterStat.index % 4 == 2} ? 'bg-amber-500/10' : 'bg-emerald-500/10'))"
                            class="absolute top-0 right-0 w-16 h-16 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110">
                        </div>

                        <!-- Time -->
                        <span
                            class="time-text relative z-10 text-sm font-semibold mb-2 text-slate-700 dark:text-slate-200"
                            th:text="${#temporals.format(hour.time, 'HH:mm')}">00:00</span>

                        <!-- Weather Icon với màu theo index -->
                        <div class="relative z-10 p-2 rounded-xl transition-colors mb-2"
                            th:classappend="${iterStat.index % 4 == 0} ? 'bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 group-hover:bg-indigo-600 group-hover:text-white' : (${iterStat.index % 4 == 1} ? 'bg-pink-50 dark:bg-pink-900/30 text-pink-600 dark:text-pink-400 group-hover:bg-pink-600 group-hover:text-white' : (${iterStat.index % 4 == 2} ? 'bg-amber-50 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 group-hover:bg-amber-600 group-hover:text-white' : 'bg-emerald-50 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 group-hover:bg-emerald-600 group-hover:text-white'))">
                            <span class="weather-icon material-icons-round text-2xl"
                                th:classappend="${T(com.weather.forecast.util.WeatherIconMapper).getIconClass(hour.weatherCode)}"></span>
                        </div>

                        <!-- Temperature -->
                        <div class="temp-text relative z-10 text-xl font-bold mb-1 text-slate-800 dark:text-white"
                            th:classappend="${iterStat.index % 4 == 0} ? 'group-hover:text-indigo-600 dark:group-hover:text-indigo-400' : (${iterStat.index % 4 == 1} ? 'group-hover:text-pink-600 dark:group-hover:text-pink-400' : (${iterStat.index % 4 == 2} ? 'group-hover:text-amber-600 dark:group-hover:text-amber-400' : 'group-hover:text-emerald-600 dark:group-hover:text-emerald-400'))"
                            th:text="${#numbers.formatDecimal(hour.temperature, 0, 0)} + '°'">
                            25°</div>

                        <!-- Weather Description (short) -->
                        <div class="desc-text relative z-10 text-[10px] text-center mb-2 text-slate-500 dark:text-slate-400"
                            th:text="${T(com.weather.forecast.util.WeatherCodeMapper).getDescription(hour.weatherCode)}">
                            Nhiều mây</div>

                        <!-- Rain probability -->
                        <div class="rain-prob relative z-10 flex items-center gap-1 text-xs px-2 py-1 rounded-full"
                            th:classappend="${iterStat.index % 4 == 0} ? 'text-indigo-600 bg-indigo-50 dark:bg-indigo-900/30 dark:text-indigo-400' : (${iterStat.index % 4 == 1} ? 'text-pink-600 bg-pink-50 dark:bg-pink-900/30 dark:text-pink-400' : (${iterStat.index % 4 == 2} ? 'text-amber-600 bg-amber-50 dark:bg-amber-900/30 dark:text-amber-400' : 'text-emerald-600 bg-emerald-50 dark:bg-emerald-900/30 dark:text-emerald-400'))">
                            <span class="material-icons-round text-[10px]">water_drop</span>
                            <span
                                th:text="${#numbers.formatDecimal(hour.precipitationProbability, 0, 0)} + '%'">45%</span>
                        </div>

                        <!-- Wind speed -->
                        <div class="wind-text relative z-10 mt-2 flex items-center gap-1 text-xs text-slate-400">
                            <span class="material-icons-round text-[10px]">air</span>
                            <span th:text="${#numbers.formatDecimal(hour.windSpeed, 0, 0)} + ' km/h'">5 km/h</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-surface-light dark:bg-surface-dark border-t border-gray-200 dark:border-gray-700 mt-8 py-12">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 lg:gap-12">
                    <!-- Cột 1: Giới thiệu dự án -->
                    <div>
                        <div class="flex items-center gap-2 mb-4">
                            <img th:src="@{/img/z.png}" alt="Weather Logo" class="w-[60px] h-[48px]">
                            <span
                                class="font-bold text-xl tracking-tight bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">Weather</span>
                        </div>
                        <p class="text-sm text-slate-500 dark:text-slate-400 leading-relaxed mb-4">
                            Thực tại không phải là một vật thể có sẵn nằm ngoài kia để ta quan sát, mà là một cấu trúc ý
                            hướng được dệt nên từ sự tương tác không thể tách rời giữa ý thức chủ thể và thế giới; do
                            đó, khi ta nhìn vào một bông hoa, ta không nhìn thấy chính bông hoa đó như nó là (cái vật tự
                            thân), mà chỉ đang nhìn thấy sự phản chiếu của chính cấu trúc nhận thức và những trải nghiệm
                            tiền-phản tính của chúng ta đang 'gán nghĩa' lên nó trong một khoảnh khắc hiện tại vĩnh cửu.
                        </p>
                        <div class="flex gap-3">
                            <a href="#"
                                class="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg hover:bg-primary hover:text-white transition-colors">
                                <span class="material-icons-round text-lg">facebook</span>
                            </a>
                            <a href="#"
                                class="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg hover:bg-primary hover:text-white transition-colors">
                                <span class="material-icons-round text-lg">share</span>
                            </a>
                        </div>
                    </div>

                    <!-- Cột 2: Điều hướng nhanh -->
                    <div>
                        <h4
                            class="font-bold text-slate-800 dark:text-white mb-4 uppercase text-sm tracking-wider flex items-center gap-2">
                            <span class="material-icons-round text-primary text-base">navigation</span>
                            Điều Hướng
                        </h4>
                        <ul class="space-y-3 text-sm">
                            <li>
                                <a th:href="@{/}"
                                    class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2">
                                    <span class="material-icons-round text-xs">chevron_right</span>
                                    Trang chủ
                                </a>
                            </li>
                            <li>
                                <a th:href="@{/chart}"
                                    class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2">
                                    <span class="material-icons-round text-xs">chevron_right</span>
                                    Biểu đồ thời tiết
                                </a>
                            </li>
                            <li>
                                <a th:href="@{/perpetual-calendar}"
                                    class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2">
                                    <span class="material-icons-round text-xs">chevron_right</span>
                                    Lịch vạn niên
                                </a>
                            </li>
                            <li>
                                <a th:href="@{/weather-news}"
                                    class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2">
                                    <span class="material-icons-round text-xs">chevron_right</span>
                                    Tin tức thời tiết
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- Cột 3: Chính sách -->
                    <div>
                        <h4
                            class="font-bold text-slate-800 dark:text-white mb-4 uppercase text-sm tracking-wider flex items-center gap-2">
                            <span class="material-icons-round text-primary text-base">verified_user</span>
                            Chính Sách
                        </h4>
                        <ul class="space-y-3 text-sm">
                            <li>
                                <a href="#"
                                    class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2">
                                    <span class="material-icons-round text-xs">chevron_right</span>
                                    Điều khoản sử dụng
                                </a>
                            </li>
                            <li>
                                <a href="#"
                                    class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2">
                                    <span class="material-icons-round text-xs">chevron_right</span>
                                    Chính sách bảo mật
                                </a>
                            </li>
                            <li>
                                <a href="#"
                                    class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2">
                                    <span class="material-icons-round text-xs">chevron_right</span>
                                    Quyền riêng tư
                                </a>
                            </li>
                            <li>
                                <a href="#"
                                    class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2">
                                    <span class="material-icons-round text-xs">chevron_right</span>
                                    Nguồn dữ liệu
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- Cột 4: Liên hệ -->
                    <div>
                        <h4
                            class="font-bold text-slate-800 dark:text-white mb-4 uppercase text-sm tracking-wider flex items-center gap-2">
                            <span class="material-icons-round text-primary text-base">contact_mail</span>
                            Liên Hệ
                        </h4>
                        <div class="space-y-3 text-sm text-slate-500 dark:text-slate-400">
                            <div class="flex items-start gap-3">
                                <span class="material-icons-round text-primary text-base mt-0.5">location_on</span>
                                <span>TP. Hồ Chí Minh, Việt Nam</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="material-icons-round text-primary text-base">email</span>
                                <a href="mailto:lgbbq9999@gmail.com"
                                    class="hover:text-primary transition-colors">lgbbq9999@gmail.com</a>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="material-icons-round text-primary text-base">phone</span>
                                <a href="tel:0342157199" class="hover:text-primary transition-colors">0342 157 199</a>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="material-icons-round text-primary text-base">schedule</span>
                                <span>Hỗ trợ 24/7</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Copyright -->
                <div
                    class="border-t border-gray-100 dark:border-gray-800 mt-10 pt-6 flex flex-col md:flex-row justify-between items-center gap-4">
                    <p class="text-sm text-slate-400">
                        © 2025 <span class="font-semibold text-primary">Weather Forecast</span> Đồ án J2EE - Dự báo
                        thời tiết.
                    </p>
                    <p class="text-xs text-slate-400">
                        Những Thằng Lính
                    </p>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Update local time
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const el = document.getElementById('local-time');
            if (el) el.textContent = timeStr;
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Highlight current hour realtime
        function highlightCurrentHour() {
            const hourlyGrid = document.getElementById('hourlyGrid');
            if (!hourlyGrid) return;

            const forecastDate = hourlyGrid.getAttribute('data-forecast-date'); // Format: yyyy-MM-dd
            const now = new Date();
            const todayStr = now.getFullYear() + '-' +
                String(now.getMonth() + 1).padStart(2, '0') + '-' +
                String(now.getDate()).padStart(2, '0');

            const currentHour = now.getHours();
            const hourlyCards = document.querySelectorAll('.hourly-card');

            // Remove highlight from all cards first
            hourlyCards.forEach(card => {
                card.classList.remove('ring-4', 'ring-primary', 'ring-offset-2', 'scale-105', 'current-hour-highlight');
            });

            // Only highlight if viewing today's forecast
            if (forecastDate === todayStr) {
                hourlyCards.forEach(card => {
                    const cardHour = parseInt(card.getAttribute('data-hour'), 10);
                    if (cardHour === currentHour) {
                        // Add subtle ring highlight for current hour
                        card.classList.add('ring-4', 'ring-primary', 'ring-offset-2', 'scale-105', 'current-hour-highlight');
                    }
                });
            }
        }

        // Run when DOM is fully loaded
        document.addEventListener('DOMContentLoaded', highlightCurrentHour);

        // Also run immediately in case DOM is already loaded
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            setTimeout(highlightCurrentHour, 100);
        }

        // Update highlight every minute (when hour may change)
        setInterval(highlightCurrentHour, 60000);
    </script>
    <script th:src="@{/js/footer.js(v=${cacheBuster})}" defer></script>
</body>

</html>