<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch Vạn Niên</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(180deg, #e8f4f8 0%, #f0f8ff 100%);
            min-height: 100vh;
        }
        .calendar-container {
            max-width: 1200px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        .calendar-header {
            background: linear-gradient(135deg, #5eb3d6 0%, #4a9ec4 100%);
            color: white;
            padding: 1.5rem 2rem;
            border-radius: 16px 16px 0 0;
        }
        .day-header {
            font-weight: 600;
            padding: 0.75rem 0.5rem;
            background: #f8fafb;
            border-radius: 6px;
            color: #5a6c7d;
            font-size: 0.9rem;
        }
        .day-header.sunday {
            color: #f56565;
        }
        .day-cell {
            min-height: 90px;
            padding: 0.75rem;
            border: 1px solid #e8eef2;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #fafcfd;
        }
        .day-cell:hover {
            background: #f0f7fa;
            border-color: #5eb3d6;
            box-shadow: 0 2px 8px rgba(94, 179, 214, 0.15);
        }
        .day-cell.empty {
            background: #f8fafb;
            cursor: default;
            border-color: #f0f4f7;
        }
        .day-cell.empty:hover {
            background: #f8fafb;
            border-color: #f0f4f7;
            box-shadow: none;
        }
        .day-cell.today {
            background: linear-gradient(135deg, #5eb3d6 0%, #4a9ec4 100%);
            color: white;
            border-color: #4a9ec4;
            box-shadow: 0 4px 12px rgba(94, 179, 214, 0.3);
        }
        .day-cell.today:hover {
            background: linear-gradient(135deg, #4a9ec4 0%, #3d8bb0 100%);
            box-shadow: 0 6px 16px rgba(94, 179, 214, 0.4);
        }
        .day-number {
            font-size: 1.15rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: #2d3748;
        }
        .day-cell.today .day-number {
            color: white;
        }
        .lunar-date {
            font-size: 0.7rem;
            color: #718096;
        }
        .day-cell.today .lunar-date {
            color: rgba(255,255,255,0.95);
        }
        .loading {
            color: #a0aec0;
            font-style: italic;
        }
        .nav-btn {
            background: white;
            color: #5eb3d6;
            border: 1px solid #d4e8f0;
            font-weight: 500;
            padding: 0.5rem 1.25rem;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }
        .nav-btn:hover {
            background: #5eb3d6;
            color: white;
            border-color: #5eb3d6;
            box-shadow: 0 2px 8px rgba(94, 179, 214, 0.25);
        }
        .modal-header {
            background: linear-gradient(135deg, #5eb3d6 0%, #4a9ec4 100%);
            color: white;
            border-bottom: none;
        }
        .modal-content {
            border: none;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body class="py-4">
<div class="container calendar-container p-0">
    <div class="calendar-header">
        <div class="d-flex justify-content-between align-items-center">
            <button id="prevMonthBtn" class="nav-btn">&lt; Tháng trước</button>
            <h2 id="currentMonthYear" class="m-0"></h2>
            <button id="nextMonthBtn" class="nav-btn">Tháng sau &gt;</button>
        </div>
    </div>

    <div class="p-4">
        <div class="row row-cols-7 g-2 mb-2" id="dayHeaders">
            <div class="col text-center day-header sunday">CN</div>
            <div class="col text-center day-header">T2</div>
            <div class="col text-center day-header">T3</div>
            <div class="col text-center day-header">T4</div>
            <div class="col text-center day-header">T5</div>
            <div class="col text-center day-header">T6</div>
            <div class="col text-center day-header">T7</div>
        </div>
        
        <div class="row row-cols-7 g-2" id="calendarGrid">
            <!-- Calendar days will be dynamically generated here -->
        </div>

        <div class="text-center mt-4 text-muted">
            <small>Nhấn vào ngày để xem chi tiết ngày âm lịch, giờ hoàng đạo, hắc đạo</small>
        </div>
    </div>
</div>

<!-- Modal for day details -->
<div class="modal fade" id="dayDetailModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Chi tiết ngày</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();

    const calendarGrid = document.getElementById('calendarGrid');
    const currentMonthYearHeader = document.getElementById('currentMonthYear');
    const prevMonthBtn = document.getElementById('prevMonthBtn');
    const nextMonthBtn = document.getElementById('nextMonthBtn');
    
    const monthNames = ["Tháng 1", "Tháng 2", "Tháng 3", "Tháng 4", "Tháng 5", "Tháng 6",
                        "Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11", "Tháng 12"];

    function renderCalendar(year, month) {
        // Clear calendar grid
        calendarGrid.innerHTML = '';
        
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const numDays = lastDay.getDate();
        const startDayOfWeek = firstDay.getDay();

        currentMonthYearHeader.textContent = `${monthNames[month]}, ${year}`;

        const today = new Date();
        const isCurrentMonth = month === today.getMonth() && year === today.getFullYear();
        const todayDate = today.getDate();

        const dayElements = [];

        // Fill leading empty days
        for (let i = 0; i < startDayOfWeek; i++) {
            const emptyDiv = document.createElement('div');
            emptyDiv.classList.add('col', 'day-cell', 'empty');
            calendarGrid.appendChild(emptyDiv);
        }

        // Fill days of the month
        for (let day = 1; day <= numDays; day++) {
            const dayDiv = document.createElement('div');
            dayDiv.classList.add('col', 'day-cell');
            
            if (isCurrentMonth && day === todayDate) {
                dayDiv.classList.add('today');
            }

            const dayNumber = document.createElement('div');
            dayNumber.classList.add('day-number');
            dayNumber.textContent = day;
            dayDiv.appendChild(dayNumber);

            const lunarDate = document.createElement('div');
            lunarDate.classList.add('lunar-date', 'loading');
            lunarDate.textContent = 'Đang tải...';
            dayDiv.appendChild(lunarDate);

            dayElements.push({ element: lunarDate, day: day });

            // Add click event
            dayDiv.addEventListener('click', () => showDayDetails(day, month, year));

            calendarGrid.appendChild(dayDiv);
        }
        
        // Fetch lunar dates for the entire month
        fetch('/api/lunar-month-dates', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ month: month + 1, year: year })
        })
        .then(response => response.json())
        .then(lunarDates => {
            dayElements.forEach((item, index) => {
                if (index < lunarDates.length) {
                    const lunarData = lunarDates[index];
                    const element = item.element;
                    
                    element.classList.remove('loading');
                    
                    if (lunarData && lunarData.day && lunarData.month) {
                        element.textContent = `${lunarData.day}/${lunarData.month} AL`;
                        if (lunarData.day === 1) {
                            element.style.fontWeight = 'bold';
                            element.style.color = '#dc3545';
                        }
                    } else {
                        element.textContent = 'N/A';
                        element.style.color = '#999';
                    }
                }
            });
        })
        .catch(error => {
            console.error('Error fetching lunar month dates:', error);
            dayElements.forEach(item => {
                item.element.classList.remove('loading');
                item.element.textContent = 'Lỗi';
                item.element.style.color = '#dc3545';
            });
        });
    }

    function showDayDetails(day, month, year) {
        const modal = new bootstrap.Modal(document.getElementById('dayDetailModal'));
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        
        modalTitle.textContent = `Ngày ${day}/${month + 1}/${year}`;
        modalBody.innerHTML = `
            <div class="text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Đang tải...</span>
                </div>
                <p class="mt-2">Đang tải thông tin chi tiết...</p>
            </div>
        `;
        
        modal.show();

        // Simulate fetching detailed information
        // Replace this with actual API call to get lunar calendar details
        setTimeout(() => {
            modalBody.innerHTML = `
                <div class="row">
                    <div class="col-6">
                        <h6>Dương lịch</h6>
                        <p class="fw-bold">${day}/${month + 1}/${year}</p>
                    </div>
                    <div class="col-6">
                        <h6>Âm lịch</h6>
                        <p class="fw-bold">15/10 (Ví dụ)</p>
                    </div>
                </div>
                <hr>
                <h6>Giờ Hoàng Đạo</h6>
                <p class="text-success">Tý (23-01h), Mão (05-07h), Ngọ (11-13h), Dậu (17-19h)</p>
                
                <h6 class="mt-3">Giờ Hắc Đạo</h6>
                <p class="text-danger">Sửu (01-03h), Thìn (07-09h), Mùi (13-15h), Tuất (19-21h)</p>
                
                <div class="alert alert-info mt-3">
                    <small><strong>Lưu ý:</strong> Đây là dữ liệu mẫu. Cần kết nối API thực tế để hiển thị thông tin chính xác.</small>
                </div>
            `;
        }, 800);
    }

    function changeMonth(delta) {
        currentMonth += delta;
        if (currentMonth < 0) {
            currentMonth = 11;
            currentYear--;
        } else if (currentMonth > 11) {
            currentMonth = 0;
            currentYear++;
        }
        renderCalendar(currentYear, currentMonth);
    }

    // Event Listeners
    prevMonthBtn.addEventListener('click', () => changeMonth(-1));
    nextMonthBtn.addEventListener('click', () => changeMonth(1));

    // Initial render
    renderCalendar(currentYear, currentMonth);
</script>
</body>
</html>